
-- This file contains DDL for creating the tables in our Patient
-- schema (from the RelationalModeling notes).
--
-- first drop the tables in case they exist
-- CASCADE CONSTRAINTS says to remove referential ICs at the same time

DROP TABLE PATIENT CASCADE CONSTRAINTS;
DROP TABLE PATIENTSYMPTOMS;
DROP TABLE HOSPITALAREAS;
DROP TABLE HOSPITALADDR;
DROP TABLE DOCTORAREAS;
DROP TABLE NURSEAREAS;
DROP TABLE NURSE CASCADE CONSTRAINTS;
DROP TABLE EMPLOYS CASCADE CONSTRAINTS;
DROP TABLE HOSPITAL CASCADE CONSTRAINTS;
DROP TABLE DOCTOR CASCADE CONSTRAINTS;

-- Create the Doctor first (no foreign keys)

CREATE TABLE DOCTOR (SSN CHAR(9) NOT NULL, LASTNAME VARCHAR(25) NOT NULL,
		     FIRSTNAME VARCHAR(20),
		     CONSTRAINT DOCTOR_PRIMARY_KEY PRIMARY KEY (SSN));

-- Create the DoctorAreas
CREATE TABLE DOCTORAREAS (DOCTORSSN CHAR(9) NOT NULL, SPECIALTY VARCHAR(255) NOT NULL,
			  CONSTRAINT DOCTORAREAS_PRIMARY_KEY PRIMARY KEY (DOCTORSSN, SPECIALTY),
			  CONSTRAINT REF_DOCTOR_FK FOREIGN KEY (DOCTORSSN) REFERENCES
			  DOCTOR(SSN));

-- Create the Nurse and NurseAreas
CREATE TABLE NURSE (SSN CHAR(9) NOT NULL, LASTNAME VARCHAR(25) NOT NULL,
		    FIRSTNAME VARCHAR(20), DOCTORSSN CHAR(9) NOT NULL,
		    NURSESUPERSSN CHAR(9),
		    CONSTRAINT NURSE_PRIMARY_KEY PRIMARY KEY (SSN),
		    CONSTRAINT REF_DOCTOR_FK FOREIGN KEY (DOCTORSSN) REFERENCES DOCTOR(SSN),
		    CONSTRAINT REF_SUPER_FK FOREIGN KEY (NURSESUPERSSN) REFERENCES NURSE(SSN));
CREATE TABLE NURSEAREAS (NURSESSN CHAR(9) NOT NULL, SPECIALTY VARCHAR(255) NOT NULL,
			 CONSTRAINT NA_PRIMARY_KEY PRIMARY KEY (NURSESSN, SPECIALTY),
			 CONSTRAINT REF_NURSE_FK FOREIGN KEY (NURSESSN) REFERENCES NURSE(SSN));

-- Create Hospital and Employs
CREATE TABLE HOSPITAL (BILLINGID CHAR(10) NOT NULL, CHIEFSURGEONSSN CHAR(9),
		       HDATE DATE, PRIMARY KEY (BILLINGID));
CREATE TABLE EMPLOYS (BILLINGID CHAR(10) NOT NULL, DOCTORSSN CHAR(9), EDATE DATE,
		      PRIMARY KEY (BILLINGID, DOCTORSSN), 
		      FOREIGN KEY (BILLINGID) REFERENCES HOSPITAL(BILLINGID),
		      FOREIGN KEY (DOCTORSSN) REFERENCES DOCTOR(SSN));

-- Note how we can put the foreign keys in employs as Hospital and Doctor relations
-- exist. But we have to go back and add the foreign key constraint in Hospital

ALTER TABLE HOSPITAL ADD CONSTRAINT REF_EMPLOYS_FK FOREIGN KEY (CHIEFSURGEONSSN)
	REFERENCES EMPLOYS(DOCTORSSN);

-- Add HospitalAddress and HospitalAreas
CREATE TABLE HOSPITALADDR (BILLINGID CHAR(10) NOT NULL, STREET VARCHAR(20) NOT NULL,
			   CITY VARCHAR(20) NOT NULL, ZIP VARCHAR(9) NOT NULL,
			   PRIMARY KEY (BILLINGID, STREET, CITY, ZIP));
CREATE TABLE HOSPITALAREAS (BILLINGID CHAR(10) NOT NULL, SPECIALTY VARCHAR(20) NOT NULL,
			    PRIMARY KEY (BILLINGID, SPECIALTY));

-- Finally, Patient and PatientSymptoms
CREATE TABLE PATIENT (SSN CHAR(9) NOT NULL, LASTNAME VARCHAR(25) NOT NULL,
		      FIRSTNAME VARCHAR(20), DOCTORSSN CHAR(9), 
		      HOSPITALBILLINGID CHAR(10), ADMITTEDDATE DATE,
		      PRIMARY KEY (SSN),
		      FOREIGN KEY (DOCTORSSN) REFERENCES DOCTOR(SSN),
		      FOREIGN KEY (HOSPITALBILLINGID) REFERENCES HOSPITAL(BILLINGID));
CREATE TABLE PATIENTSYMPTOMS (PATIENTSSN CHAR(9) NOT NULL, SYMPTOM VARCHAR(255) NOT NULL,
			      PRIMARY KEY (PATIENTSSN, SYMPTOM),
			      FOREIGN KEY (PATIENTSSN) REFERENCES PATIENT(SSN));
COMMIT;
